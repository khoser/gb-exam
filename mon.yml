---
- hosts: mon
  gather_facts: no
  roles:
    - role: mon
      tags: [mon]

- hosts: mon
  gather_facts: yes
  vars_files:
    - group_vars/mon.yml #В этом файле список портов, которые нужно открыть
  roles:
    - role: firewall

- hosts: mon
  roles:
  - prometheus
  vars:
    prometheus_targets:
      node:
        - targets: "{{ groups['all'] | map('extract', hostvars, ['ansible_host']) | map('regex_replace', '^(.*)$', '\\1:9100') | list }}"
          labels:
            env: vektoroo

- hosts: mon
  roles:
    - role: mon-nginx
